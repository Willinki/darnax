
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Deep Asymmetric Recurrent Networks in Jax">
      
      
      
        <link rel="canonical" href="https://willinki.github.io/darnax/tutorials/05_orchestrators/">
      
      
        <link rel="prev" href="../04_layermaps/">
      
      
        <link rel="next" href="../06_simple_net_on_artificial_data/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>05 — Orchestrators - Darnax</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#05-orchestrators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Darnax" class="md-header__button md-logo" aria-label="Darnax" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Darnax
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              05 — Orchestrators
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Willinki/darnax" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Willinki/darnax
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../" class="md-tabs__link">
        
  
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/" class="md-tabs__link">
        
  
  
    
  
  Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Darnax" class="md-nav__button md-logo" aria-label="Darnax" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Darnax
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Willinki/darnax" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Willinki/darnax
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_jax_and_equinox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01 — JAX, Equinox, and Pytrees
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02 — States
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03 — Modules (Layers and Adapters)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_layermaps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04 — LayerMaps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    05 — Orchestrators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    05 — Orchestrators
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-conceptual-role" class="md-nav__link">
    <span class="md-ellipsis">
      1. Conceptual role
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-two-phases-of-dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      2. Two phases of dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-public-api" class="md-nav__link">
    <span class="md-ellipsis">
      3. Public API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Public API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stepstate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      step(state, rng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step_inferencestate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      step_inference(state, rng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictstate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      predict(state, rng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backwardstate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      backward(state, rng)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-structural-properties" class="md-nav__link">
    <span class="md-ellipsis">
      4. Structural properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-typical-usage" class="md-nav__link">
    <span class="md-ellipsis">
      5. Typical usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-more-complex-logic" class="md-nav__link">
    <span class="md-ellipsis">
      6. More complex logic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-summary" class="md-nav__link">
    <span class="md-ellipsis">
      7. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_simple_net_on_artificial_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06 — Simple Training Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_optimized_training_on_mnist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07 — Training on MNIST with darnax (JAX-first, CPU)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_trainer_on_mnist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08 — Training on MNIST with darnax using DynamicalTrainer (JAX-first, CPU)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-conceptual-role" class="md-nav__link">
    <span class="md-ellipsis">
      1. Conceptual role
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-two-phases-of-dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      2. Two phases of dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-public-api" class="md-nav__link">
    <span class="md-ellipsis">
      3. Public API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Public API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stepstate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      step(state, rng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step_inferencestate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      step_inference(state, rng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictstate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      predict(state, rng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backwardstate-rng" class="md-nav__link">
    <span class="md-ellipsis">
      backward(state, rng)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-structural-properties" class="md-nav__link">
    <span class="md-ellipsis">
      4. Structural properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-typical-usage" class="md-nav__link">
    <span class="md-ellipsis">
      5. Typical usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-more-complex-logic" class="md-nav__link">
    <span class="md-ellipsis">
      6. More complex logic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-summary" class="md-nav__link">
    <span class="md-ellipsis">
      7. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Willinki/darnax/edit/master/docs/tutorials/05_orchestrators.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="05-orchestrators">05 — Orchestrators<a class="headerlink" href="#05-orchestrators" title="Permanent link">&para;</a></h1>
<p>Having introduced <strong>states</strong>, <strong>modules</strong>, and <strong>layermaps</strong>, we now come to the final structural element: the <strong>orchestrator</strong>.
Where the previous abstractions describe <em>what the network is</em>, the orchestrator specifies <em>how the network evolves in time</em>.
It is the execution engine of the architecture: at each iteration it routes messages, applies updates, and advances the global state.</p>
<hr />
<h2 id="1-conceptual-role">1. Conceptual role<a class="headerlink" href="#1-conceptual-role" title="Permanent link">&para;</a></h2>
<p>The orchestrator governs the <strong>dynamical process</strong> that characterizes this family of recurrent networks.</p>
<p>As everything in the library, we propose a simple interface for the object, described below, and a first
implementation. In this case, we focus on the <code>SequentialOrchestrator</code>, that plays nicely with sequential states
and the sequential nature of the layer map. In detail, at each step, this specific orchestrator does the following:</p>
<ol>
<li><strong>Message collection</strong> — for each receiving layer <span class="arithmatex">\(i\)</span>, all modules <span class="arithmatex">\((i,j)\)</span> in the LayerMap are evaluated on the current sender states <span class="arithmatex">\(s^{(j)}\)</span>.</li>
<li><strong>Aggregation and activation</strong> — the diagonal module <span class="arithmatex">\((i,i)\)</span> aggregates the incoming messages into a pre-activation <span class="arithmatex">\(h^{(i)}\)</span> via its <code>reduce</code> method, then applies its nonlinearity with <code>activation</code>, yielding the new state slice <span class="arithmatex">\(s^{(i)}\)</span>.</li>
<li><strong>State update</strong> — the new slice replaces the old one in the global state, producing the next global configuration.</li>
<li><strong>Learning updates</strong> — in the training regime, each module also provides a <strong>local parameter update</strong> through its <code>backward(x, y, y_hat)</code> method. These are gathered into a LayerMap-structured PyTree of updates.</li>
</ol>
<p>In this way, the orchestrator realizes the iterative dynamics described in the paper: a <strong>distributed, gradient-free learning mechanism</strong> in which information is exchanged locally and parameters are updated via local rules.</p>
<hr />
<h2 id="2-two-phases-of-dynamics">2. Two phases of dynamics<a class="headerlink" href="#2-two-phases-of-dynamics" title="Permanent link">&para;</a></h2>
<p>In line with the two-phase protocol introduced in the theoretical model, the orchestrator provides two distinct update functions:</p>
<ul>
<li>
<p><strong>Training phase (<code>step</code>)</strong>
  All available messages are considered, both forward (lower triangle) and backward (upper triangle). This corresponds to the supervised or clamped regime where input and output information are both present.</p>
</li>
<li>
<p><strong>Inference phase (<code>step_inference</code>)</strong>
  Only causal messages are retained: for receiver <span class="arithmatex">\(i\)</span>, senders <span class="arithmatex">\(j &lt; i\)</span> are discarded. Thus, information from the output or “future” layers does not leak backward. This corresponds to the free relaxation regime in which the system stabilizes autonomously.</p>
</li>
</ul>
<p>This explicit separation ensures that training and inference dynamics are clearly distinguished in the implementation.</p>
<hr />
<h2 id="3-public-api">3. Public API<a class="headerlink" href="#3-public-api" title="Permanent link">&para;</a></h2>
<p>All orchestrators subclass the following abstract interface:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AbstractOrchestrator</span><span class="p">(</span><span class="n">eqx</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">lmap</span><span class="p">:</span> <span class="n">LayerMap</span>  <span class="c1"># fixed topology (rows, columns, edges)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">StateT</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">StateT</span><span class="p">,</span> <span class="n">KeyArray</span><span class="p">]:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run one full update step (training phase).&quot;&quot;&quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">StateT</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">StateT</span><span class="p">,</span> <span class="n">KeyArray</span><span class="p">]:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run one update step (inference phase, discarding rightward messages).&quot;&quot;&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">SequentialState</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">SequentialState</span><span class="p">,</span> <span class="n">KeyArray</span><span class="p">]:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the output state s[-1].&quot;&quot;&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">StateT</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LayerMap</span><span class="p">:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute module-local updates in a LayerMap-structured PyTree.&quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="stepstate-rng"><code>step(state, rng)</code><a class="headerlink" href="#stepstate-rng" title="Permanent link">&para;</a></h3>
<ul>
<li>Executes one synchronous update of the network using <em>all</em> messages, both backward and forward.</li>
<li>Returns the updated state and an advanced random key.</li>
<li>It does not compute messages for the last row (messages going towards the output). So the last component of the state
is never updated when applying <code>step</code>. There is a specific method called <code>predict</code> that needs to be run after the end of
the dynamics if you want the actual prediction of the model.</li>
</ul>
<h3 id="step_inferencestate-rng"><code>step_inference(state, rng)</code><a class="headerlink" href="#step_inferencestate-rng" title="Permanent link">&para;</a></h3>
<ul>
<li>Executes one update considering only messages from <span class="arithmatex">\(j \geq i\)</span>.</li>
<li>Used for prediction after training, ensuring purely causal message passing.</li>
<li>As step, it does not compute messages for the last row (messages going towards the output). So the last component of the state
is never updated when applying <code>step</code>. There is a specific method called <code>predict</code> that needs to be run after the end of
the dynamics if you want the actual prediction of the model.</li>
</ul>
<h3 id="predictstate-rng"><code>predict(state, rng)</code><a class="headerlink" href="#predictstate-rng" title="Permanent link">&para;</a></h3>
<ul>
<li>Executes the update of the output state via usual forward + aggregation + activation. It is useful to check the implementation
of <code>OutputLayer</code> to actually understand what is happening, as it is simply a sink that aggregates prediction from its neighboring adapters.</li>
<li>Separating internal state update and final prediction allows to save some operations (computing the update of the output state at every step
is useless), and also simplifies the overall API, see Tutorial 6.</li>
</ul>
<h3 id="backwardstate-rng"><code>backward(state, rng)</code><a class="headerlink" href="#backwardstate-rng" title="Permanent link">&para;</a></h3>
<ul>
<li>For each edge <span class="arithmatex">\((i,j)\)</span>, invokes <code>lmap[i,j].backward(x=state[j], y=state[i], y_hat=local_field)</code> to obtain a <strong>module-shaped update</strong>.</li>
<li>Returns a <strong>LayerMap</strong> with the same static structure as the original, but whose leaves are parameter updates.</li>
<li>This PyTree can be passed directly to Optax as if it were a gradient structure.</li>
</ul>
<hr />
<h2 id="4-structural-properties">4. Structural properties<a class="headerlink" href="#4-structural-properties" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Static topology</strong>: The orchestrator’s LayerMap has a fixed set of rows, columns, and edges. This immutability is necessary for <strong>JAX compatibility</strong>, as PyTree structures must remain constant across compiled functions.</li>
<li><strong>Dynamic values</strong>: Within this static skeleton, the array values of module parameters evolve freely during training.</li>
<li><strong>PyTree compliance</strong>: Because the orchestrator itself is an Equinox module, it is also a PyTree. Its parameters can be filtered, updated, and optimized exactly like any other object in the system.</li>
<li><strong>Transformation compatibility</strong>: The orchestrator is fully compatible with <code>jax.jit</code>, <code>jax.vmap</code>, and all other JAX transformations. Since the topology is static, compilation is stable; only array values trigger recompilation when their shapes change.</li>
</ul>
<hr />
<h2 id="5-typical-usage">5. Typical usage<a class="headerlink" href="#5-typical-usage" title="Permanent link">&para;</a></h2>
<p>A typical training loop involving an orchestrator proceeds as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Forward update (training regime)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">state</span><span class="p">,</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># Forward update (inference regime)</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">state</span><span class="p">,</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">step_inference</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># Compute module-local updates</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">upd_lmap</span> <span class="o">=</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># Apply updates with Optax</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">grads</span>  <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">upd_lmap</span><span class="p">,</span> <span class="n">eqx</span><span class="o">.</span><span class="n">is_inexact_array</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="n">params</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">orchestrator</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">eqx</span><span class="o">.</span><span class="n">is_inexact_array</span><span class="p">)</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">deltas</span><span class="p">,</span> <span class="n">opt_state</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="n">new_lmap</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">apply_updates</span><span class="p">(</span><span class="n">orchestrator</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">deltas</span><span class="p">)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="c1"># Replace the LayerMap inside the orchestrator</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">orchestrator</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">lmap</span><span class="p">,</span> <span class="n">orchestrator</span><span class="p">,</span> <span class="n">new_lmap</span><span class="p">)</span>
</code></pre></div>
<p>Here the <strong>updates are not gradients</strong>: they are the outcome of local learning rules defined at the module level. Optax is used purely as a robust update engine.</p>
<hr />
<h2 id="6-more-complex-logic">6. More complex logic<a class="headerlink" href="#6-more-complex-logic" title="Permanent link">&para;</a></h2>
<p>Right until now we described a specific instance of orchestrator, i.e. the <code>SequentialOrchestrator</code>.
It plays nicely with both the sequantial state and the sequential implementation of the layer map.</p>
<p>The only assumption about this structures is a notion of <em>order</em> in the network, meaning that the first layer comes first, the second comes second, etc...</p>
<p>This is totally arbitrary, this library allows for any structure and logic in the network functioning, a first example might be a totally synchronous
network, where there is no notion of order and all layers are treated in sync. It is also possible to define a <em>group</em> structure, where different layers
belong to different groups, each handled concurrently. This might involve an extension of the <code>LayerMap</code> to allow for string keys to identify groups...</p>
<p>Another option is to specialize architectures for speed and efficiency. Instead of working with dict of dicts and simple loops, we might want to decide
to pad and stack layer states together to be handled in parallel. This is also an easy extension of <code>LayerMap</code> and <code>Orchestrator</code>.</p>
<p>We might even put orchestrators inside single modules, to encapsulate a into a single object complex logic.</p>
<h2 id="7-summary">7. Summary<a class="headerlink" href="#7-summary" title="Permanent link">&para;</a></h2>
<ul>
<li>The <strong>orchestrator</strong> advances the network’s dynamics by routing messages, aggregating them, and updating the global state.</li>
<li><strong><code>step</code></strong> executes the full supervised/clamped update; <strong><code>step_inference</code></strong> executes the free, causal update.</li>
<li><strong><code>backward</code></strong> collects local updates into a LayerMap-shaped PyTree, aligned with the parameter structure, enabling seamless integration with Optax.</li>
<li>The orchestrator is a <strong>PyTree with static structure</strong>: immutable topology, mutable parameter values. This guarantees full compatibility with JAX transformations and ensures efficient compilation.</li>
</ul>
<p>Through the orchestrator, the network acquires its <strong>temporal dimension</strong>: states evolve, messages flow, and local rules drive learning, exactly as described in the underlying theoretical framework.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "content.code.copy", "content.action.edit", "toc.follow", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>